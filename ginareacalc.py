# -*- coding: utf-8 -*-
"""GinareaCalc

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1gNWlut5rRbj3Ds3y5eABfaTC6QAO_FRl
"""

import streamlit as st
import pandas as pd
import numpy as np

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
st.set_page_config(
    page_title="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä Ginarea",
    page_icon="üìà",
    layout="wide"
)

# --- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ ---
st.title("üìà –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–µ—Ç–∫–∏ –æ—Ä–¥–µ—Ä–æ–≤ (–ª–æ–≥–∏–∫–∞ Ginarea)")
st.write("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏, —á—Ç–æ–±—ã —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤–∞—à—É DCA-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é.")

# --- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö ---
with st.sidebar:
    st.header("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")
    initial_order_size = st.number_input("–ù–∞—á–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä ($)", min_value=0.1, value=10.0, step=1.0)
    safety_order_size = st.number_input("–°—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã–π –æ—Ä–¥–µ—Ä ($)", min_value=0.1, value=10.0, step=1.0)
    safety_orders_count = st.number_input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞—Ö–æ–≤–æ—á–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ (–°–û)", min_value=1, value=20, step=1)
    price_step_percent = st.number_input("–®–∞–≥ —Ü–µ–Ω—ã (%)", min_value=0.1, value=1.0, step=0.1)
    price_step_multiplier = st.number_input("–ú–Ω–æ–∂–∏—Ç–µ–ª—å —à–∞–≥–∞ —Ü–µ–Ω—ã", min_value=0.1, value=1.5, step=0.1)

# --- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å: –†–∞—Å—á–µ—Ç—ã –∏ –≤—ã–≤–æ–¥ ---
if st.sidebar.button("üöÄ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–µ—Ç–∫—É"):
    # --- –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ (–∏–∑ Colab) ---
    price_step = price_step_percent / 100.0
    order_sizes = [safety_order_size] * safety_orders_count

    price_deviations = []
    current_step = price_step
    for _ in range(safety_orders_count):
        price_deviations.append(current_step)
        current_step *= price_step_multiplier

    required_deposit = initial_order_size + sum(order_sizes)
    trading_range_sum = sum(price_deviations) * 100

    # --- –í—ã–≤–æ–¥ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π ---
    st.header("–ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏")
    col1, col2 = st.columns(2)
    with col1:
        st.metric("–¢—Ä–µ–±—É–µ–º—ã–π –¥–µ–ø–æ–∑–∏—Ç", f"${required_deposit:,.2f}")
    with col2:
        st.metric("–ò—Ç–æ–≥–æ–≤—ã–π Trading Range", f"{trading_range_sum:,.2f}%")

    # --- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ –¥–µ—Ç–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã ---
    st.header("–î–µ—Ç–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–µ—Ç–∫–∏ –æ—Ä–¥–µ—Ä–æ–≤")

    order_data_list = []
    cumulative_volume = initial_order_size
    cumulative_range = 0.0
    for i in range(safety_orders_count):
        cumulative_volume += order_sizes[i]
        cumulative_range += price_deviations[i] * 100
        order_data_list.append({
            '‚Ññ –æ—Ä–¥–µ—Ä–∞': str(i + 1),
            '–†–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ ($)': order_sizes[i],
            '–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã (%)': price_deviations[i] * 100,
            '–°—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä–µ–º ($)': cumulative_volume,
            'Trading Range (%)': cumulative_range
        })

    order_data_list.insert(0, {
        '‚Ññ –æ—Ä–¥–µ—Ä–∞': '–ù–∞—á–∞–ª—å–Ω—ã–π',
        '–†–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ ($)': initial_order_size,
        '–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã (%)': 0.0,
        '–°—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä–µ–º ($)': initial_order_size,
        'Trading Range (%)': 0.0
    })

    full_grid_df = pd.DataFrame(order_data_list).set_index('‚Ññ –æ—Ä–¥–µ—Ä–∞')

    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º DataFrame —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    st.dataframe(full_grid_df.style.format({
        '–†–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞ ($)': '${:,.2f}',
        '–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã (%)': '{:,.2f}%',
        '–°—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä–µ–º ($)': '${:,.2f}',
        'Trading Range (%)': '{:,.2f}%'
    }))

else:
    st.info("–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–µ—Ç–∫—É'.")